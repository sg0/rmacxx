name: CI

# Controls when the workflow will run
on: [push,pull_request,workflow_dispatch]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        mpi: ["mpich", "openmpi"]
    name: ${{ matrix.mpi }}
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Setup MPI
        uses: mpi4py/setup-mpi@v1
      - name: Set up Clang
        run: sudo apt update && (echo "y" | sudo apt install g++-10) && sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-10 50
      - name: Run Makefile Check
        run: make -C tests check -k -B
